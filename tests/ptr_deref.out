@[translated]
module main

// Test pointer dereference operations
struct Mobj_t {
	value int
	bnext &Mobj_t
	bprev &Mobj_t
}

fn test_ptr_ops(endptr &&u8, value &int) {
	// Reading from dereferenced pointer
	if (unsafe { *endptr }) != &i8((unsafe { nil })) {
		// Assigning to dereferenced pointer
		unsafe {
			*value = 42
		}
	}
	abc := 123
	pabc := &abc
	unsafe {
		*value = *pabc
	}
	// check `*x = *y = value;`
	count := 10
	dc_colormap := &count
	dc_source := &count
	frac := 5
	fracstep := 2
	fracbits := 2
	dest1 := &int(0)
	dest2 := &int(0)
	dest3 := &int(0)
	for {
		unsafe {
			*dest1 = dc_colormap[dc_source[(frac >> fracbits) & 127]]
		}
		unsafe {
			*dest2 = *dest1
		}
		unsafe {
			*dest3 = *dest2
		}
		dest1 += 320
		dest2 += 320
		dest3 += 320
		frac += fracstep
		// while()
		if !(count--) {
			break
		}
	}
	// check chained dereferencing:
	the_thing := Mobj_t{}
	the_thing.value = 456
	thing := &the_thing
	link := &&Mobj_t(0)
	thing.bnext = unsafe { *link }
	if unsafe { *link != nil } {
		unsafe {
			(*link).bprev = thing
		}
	}
	unsafe {
		*link = thing
	}
}
